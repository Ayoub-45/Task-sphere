name: CI/CD Pipeline

on:
  push:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Set up Docker Buildx
    uses: docker/setup-buildx-action@v3

  - name: Log in to Docker Hub
    uses: docker/login-action@v3
    with:
      username: ${{ secrets.DOCKERHUB_USERNAME }}
      password: ${{ secrets.DOCKERHUB_TOKEN }}

  # --- BACKEND BUILD AND PUSH ---
  - name: Build and push backend image
    uses: docker/build-push-action@v6
    with:
      context: ./backend
      push: true
      tags: ${{ secrets.DOCKERHUB_USERNAME }}/tasksphere-backend:latest

  # --- FRONTEND BUILD AND PUSH (NEW STEP) ---
  - name: Build and push frontend image
    uses: docker/build-push-action@v6
    with:
      # Assuming your frontend Dockerfile and code live in the 'frontend' directory
      context: ./frontend
      push: true
      tags: ${{ secrets.DOCKERHUB_USERNAME }}/tasksphere-backend:latest
